/*! session 2015-03-18 */
ReactiveStore=function(){"use strict";function a(a){var b=[],c={fn:a,flush:function(){_.some(b,_fn.dot("invalid"))&&c.run(!1)},addDependency:function(a){-1===b.indexOf(a)&&b.push(a)},run:function(d){b=[];var f=e;e=c,a(d),e=f}};return c}function b(){var b={changed:function(){b.invalid=!0,a.flush()},depend:function(){e&&e.addDependency(b)}};return b}function c(a,b){function c(){return _.reduce(f,function(b,c){var d=(c.replace(a+".",""),g[c].value);if(void 0!==d){var e=_.last(c.split("."));b.value[e]=d}return b},{value:[],deps:g[a].deps})}function d(){return _.reduce(f,function(b,c){var d=c.replace(a+".",""),e=g[c].value;return void 0!==e&&_fn.setProp(d,b.value,e),b},{value:{},deps:g[a].deps})}function e(a){return _.every(a,function(a){return/^[^\.]*\.[0-9]*$/.test(a)})}var f=_.filter(_.keys(g),function(b){return b===a||0===b.indexOf(a+".")});return 0===f.length?g[a]={value:b,deps:[]}:1===f.length&&f[0]===a?g[a]:(g[a]=g[a]||{value:void 0,deps:[]},e(f)?c():d())}function d(a){for(var b=[];a.length;)g[a]&&(b=b.concat(g[a].deps),g[a].deps=[]),a=-1!==a.indexOf(".")?a.replace(/\.[^\.]*$/,""):"";_.each(b,function(a){a.changed()})}var e,f,g={},h=[];a.flush=function(){_fn.fmap(_fn.exec("flush"),h)};var i={clearChildren:function(a){_.each(_.keys(i.dump()),function(b){a!==b&&_.startsWith(b,a)&&0===g[b].deps.length&&delete g[b]})},set:function(a,b){function e(){i.clearChildren(a),_.each(b,function(b,c){i.set(a+"."+c,b)}),c(a).dflt={},0===_.keys(b).length&&d(a)}function g(){i.clearChildren(a),_.each(b,function(b,c){i.set(a+"."+c,b)}),c(a).dflt=[],0===b.length&&d(a)}function h(){var e=c(a);e.value!==b&&(e.value=b,e.dflt=void 0,d(a))}f&&console.log("set("+a+", "+b+")"),_.isPlainObject(b)?e():_.isArray(b)?g():h()},get:function(a){function d(a){return _.isPlainObject(a)&&_.every(Object.keys(a),function(a){return/^[0-9]*$/.test(a)})}function e(a){return _.reduce(a,function(a,b,c){return a[c]=b,a},[])}f&&console.log("get("+a+")");var g=c(a),h=b();return h.depend(),g.deps.push(h),d(g.value)?e(g.value):void 0!==g.value?g.value:g.dflt},dump:function(){return _.reduce(_.keys(g),function(a,b){var c=g[b].value;return void 0!==c&&(_.isDate(c)&&(c=c.toISOString()),a[b]=c),a},{})},load:function(a){_.each(a,function(a,b){/(\d{4})-(\d{2})-(\d{2})T(\d{2})\:(\d{2})\:(\d{2})/.test(a)&&(a=new Date(a)),g[b]={value:a,deps:[]}})},autorun:function(b){var c=_.find(h,{fn:b});c?c.run(!1):(c=a(b),c.run(!0),h.push(c))},nonReactive:function(a){var b=e;e=void 0,a(),e=b},debug:{on:function(){f=!0},off:function(){f=!1}}};return i};