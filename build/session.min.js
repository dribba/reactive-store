/*! session 2014-12-04 */
!function(a){"use strict";function b(a){var b=[],c={fn:a,flush:function(){_.some(b,_.property("invalid"))&&c.run({})},addDependency:function(a){-1===b.indexOf(a)&&b.push(a)},run:function(d){b=[];var f=e;e=c,a(d),e=f}};return c}function c(){var a={changed:function(){a.invalid=!0,b.flush()},depend:function(){e&&e.addDependency(a)}};return a}function d(a,b){var c=f[a]||(f[a]={value:b});return c.deps=c.deps||[],c}var e,f={},g=[];b.flush=function(){_.each(g,_fn.exec("flush"))},a.Session={set:function(a,b){var c=d(a);c.value=b;var e=c.deps;c.deps=[],_.each(e,function(a){a.changed()})},get:function(a){var b=d(a),e=c();return e.depend(),b.deps.push(e),b.value},getProp:_.curry(function(a,b){var c=Session.get(a);return c?_fn.dot(b,c):void 0}),setProp:_.curry(function(a,b,c){var e=d(a);e.value||(e.value={}),_fn.setProp(b,e.value,c),Session.set(a,e.value)}),isPropDefined:function(a,b){return void 0!==Session.getProp(a,b)},ifPropDefined:function(a,b,c){var d=Session.getProp(a,b);!(void 0===d||!c(d))},ifPropNotDefined:function(a,b,c){void 0===Session.getProp(a,b)&&c()},isDefined:function(a){return void 0!==Session.get(a)},isNotDefined:function(a){return!Session.isDefined(a)},ifNotDefined:function(a,b){Session.isDefined(a)||b()},isEqual:function(a,b){return Session.get(a)===b},ifEquals:function(a,b,c){var d=Session.get(a);return b===d&&c(d),{"else":function(a){b!==d&&a(d)}}},isPropEquals:function(a,b,c){return Session.getProp(a,b)===c},ifPropEquals:function(a,b,c,d){var e=Session.getProp(a,b);return c===e&&d(e),{"else":function(a){c!==e&&a(e)}}},dict:function(){return f},dump:function(){return _.reduce(_.keys(f),function(a,b){return a[b]=f[b].value,a},{})},load:function(a){_.each(a,function(a,b){Session.set(b,a)})},clear:function(a){a?delete f[a]:_.each(_.keys(f),function(a){delete f[a]})}},a.Autorun=function(a){var c=_.find(g,{fn:a});c?c.run({}):(c=b(a),c.run({firstRun:!0}),g.push(c))}}(this);